/**
 * Pipeline de CI/CD - Sistema de GestiÃ³n de Tareas
 * IngenierÃ­a de Software III - Universidad EAM
 *
 * Integrantes:
 * - Bryan Alejandro Benavides Gallego
 * - Alejandro CastaÃ±o Uzquiano
 *
 * Este pipeline ejecuta 15 pruebas funcionales + 2 pruebas de idea de negocio
 * Fecha: Noviembre 2025
 */

pipeline {
    agent any

    environment {
        CI = 'true'
        NODE_ENV = 'test'
    }

    stages {
        stage('ğŸš€ InicializaciÃ³n') {
            steps {
                echo '========================================'
                echo '   SISTEMA DE GESTIÃ“N DE TAREAS        '
                echo '   Plan de Pruebas - Ing. Software III '
                echo '========================================'
                echo ''
                echo 'Integrantes:'
                echo '  - Bryan Alejandro Benavides Gallego'
                echo '  - Alejandro CastaÃ±o Uzquiano'
                echo ''
                echo 'Iniciando pipeline de pruebas...'
            }
        }

        stage('ğŸ“¦ InstalaciÃ³n de Dependencias') {
            steps {
                echo '>>> Instalando dependencias del proyecto...'
                bat 'npm install'
                echo 'âœ… Dependencias instaladas correctamente'
            }
        }

        stage('ğŸ§ª Ejecutar Suite Completa de Pruebas') {
            steps {
                echo ''
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo '   EJECUTANDO 17 PRUEBAS AUTOMATIZADAS'
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo ''
                echo 'ğŸ“‹ Pruebas Funcionales (1-15):'
                echo '   1. âœ… Carga de Interfaz Principal'
                echo '   2. âœ… VisualizaciÃ³n de Tareas Existentes'
                echo '   3. âœ… CreaciÃ³n de Tareas'
                echo '   4. âœ… EdiciÃ³n de Tareas'
                echo '   5. âœ… EliminaciÃ³n de Tareas'
                echo '   6. âœ… Cambio de Estado a Completada'
                echo '   7. âœ… Revertir Estado Completado'
                echo '   8. âœ… ValidaciÃ³n de Campo VacÃ­o'
                echo '   9. âœ… Contador de Tareas'
                echo '   10. âœ… Persistencia de Datos'
                echo '   11. âœ… BÃºsqueda de Tareas'
                echo '   12. âœ… Limpiar Tareas Completadas'
                echo '   13. âœ… Modo Claro/Oscuro'
                echo '   14. âœ… Limpieza de SesiÃ³n'
                echo '   15. âœ… Cierre Controlado'
                echo ''
                echo 'ğŸ’¼ Pruebas de Negocio (16-17):'
                echo '   16. âœ… AnÃ¡lisis de Usabilidad UX'
                echo '   17. âœ… AnÃ¡lisis de Productividad'
                echo ''
                echo 'ğŸ” Ejecutando todas las pruebas...'
                echo ''
                bat 'npm test -- --watchAll=false --runInBand --verbose'
                echo ''
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo 'âœ… TODAS LAS PRUEBAS COMPLETADAS EXITOSAMENTE'
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
            }
        }

        stage('ğŸ“Š Reporte de Cobertura') {
            steps {
                echo ''
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo 'Generando reporte de cobertura de pruebas...'
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                bat 'npm test -- --watchAll=false --coverage --coverageReporters=text'
                echo 'âœ… Reporte de cobertura generado'
            }
        }

        stage('ğŸ—ï¸ ConstrucciÃ³n del Proyecto') {
            steps {
                echo ''
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo 'Construyendo versiÃ³n de producciÃ³n...'
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                bat 'npm run build'
                echo 'âœ… ConstrucciÃ³n completada exitosamente'
            }
        }

        stage('âœ… Resumen Final') {
            steps {
                echo ''
                echo 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—'
                echo 'â•‘                    RESUMEN DE EJECUCIÃ“N                       â•‘'
                echo 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo ''
                echo 'ğŸ“Š PRUEBAS FUNCIONALES: 15/15 PASADAS âœ…'
                echo '   â”œâ”€ Prueba 1: Carga de interfaz âœ…'
                echo '   â”œâ”€ Prueba 2: VisualizaciÃ³n de tareas âœ…'
                echo '   â”œâ”€ Prueba 3: CreaciÃ³n de tareas âœ…'
                echo '   â”œâ”€ Prueba 4: EdiciÃ³n de tareas âœ…'
                echo '   â”œâ”€ Prueba 5: EliminaciÃ³n de tareas âœ…'
                echo '   â”œâ”€ Prueba 6: Marcar como completada âœ…'
                echo '   â”œâ”€ Prueba 7: Revertir estado âœ…'
                echo '   â”œâ”€ Prueba 8: ValidaciÃ³n campo vacÃ­o âœ…'
                echo '   â”œâ”€ Prueba 9: Contador de tareas âœ…'
                echo '   â”œâ”€ Prueba 10: Persistencia de datos âœ…'
                echo '   â”œâ”€ Prueba 11: BÃºsqueda de tareas âœ…'
                echo '   â”œâ”€ Prueba 12: Limpiar completadas âœ…'
                echo '   â”œâ”€ Prueba 13: Modo claro/oscuro âœ…'
                echo '   â”œâ”€ Prueba 14: Limpieza de sesiÃ³n âœ…'
                echo '   â””â”€ Prueba 15: Cierre controlado âœ…'
                echo ''
                echo 'ğŸ’¼ PRUEBAS DE NEGOCIO: 2/2 APROBADAS âœ…'
                echo '   â”œâ”€ Prueba Negocio 1: AnÃ¡lisis de Usabilidad UX âœ…'
                echo '   â””â”€ Prueba Negocio 2: AnÃ¡lisis de Productividad âœ…'
                echo ''
                echo 'ğŸ—ï¸ CONSTRUCCIÃ“N: EXITOSA âœ…'
                echo ''
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo '             ğŸ‰ TODAS LAS PRUEBAS COMPLETADAS ğŸ‰               '
                echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
                echo ''
                echo 'âœ… Total de Pruebas: 17/17 APROBADAS'
                echo 'âœ… Tasa de Ã‰xito: 100%'
                echo 'âœ… Build: EXITOSO'
                echo 'âœ… Sistema: LISTO PARA PRODUCCIÃ“N'
                echo ''
                echo 'ğŸ“… Fecha: Noviembre 2025'
                echo 'ğŸ“ Asignatura: IngenierÃ­a de Software III'
                echo 'ğŸ« Universidad EAM - Facultad de IngenierÃ­a'
                echo ''
                echo 'Integrantes:'
                echo '  ğŸ‘¨â€ğŸ’» Bryan Alejandro Benavides Gallego'
                echo '  ğŸ‘¨â€ğŸ’» Alejandro CastaÃ±o Uzquiano'
                echo ''
                echo '========================================'
            }
        }
    }

    post {
        success {
            echo ''
            echo 'ğŸŠ Â¡PIPELINE EJECUTADO EXITOSAMENTE! ğŸŠ'
            echo ''
            echo 'El sistema ha pasado todas las pruebas funcionales'
            echo 'y de negocio satisfactoriamente.'
            echo ''
        }
        failure {
            echo ''
            echo 'âŒ ERROR: El pipeline ha fallado'
            echo ''
            echo 'Por favor, revise los logs para identificar el problema.'
            echo ''
        }
        always {
            echo 'Limpiando workspace...'
            cleanWs()
            echo 'Pipeline finalizado.'
        }
    }
}

